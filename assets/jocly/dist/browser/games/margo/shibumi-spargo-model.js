exports.model=Model={Game:{},Board:{},Move:{}},Model.Game.InitGame=function(){for(var r=this,o=this.mOptions.size,e=[],t=[],i=0,a=0,n=[],s=0;s<o;s++)n.push(a),a+=(o-s)*(o-s);for(var s=0;s<o;s++)for(var p=0;p<o-s;p++)for(var u=0;u<o-s;u++){var l=i++;e[l]=[p,u,s],t[l]=[];for(var h=0;h<2;h++)for(var f=0;f<2;f++){var v=s-1,d=p+h,g=u+f;v>=0&&v<o&&d>=0&&d<o-v&&g>=0&&g<o-v?t[l].push(n[v]+d*(o-v)+g):t[l].push(null)}var c=[[0,-1],[0,1],[-1,0],[1,0]];for(var b in c){var m=c[b],v=s,d=p+m[0],g=u+m[1];v>=0&&v<o&&d>=0&&d<o-v&&g>=0&&g<o-v?t[l].push(n[v]+d*(o-v)+g):t[l].push(null)}for(var h=-1;h<1;h++)for(var f=-1;f<1;f++){var v=s+1,d=p+h,g=u+f;v>=0&&v<o&&d>=0&&d<o-v&&g>=0&&g<o-v?t[l].push(n[v]+d*(o-v)+g):t[l].push(null)}}this.g.Graph=t,this.g.Coord=e,this.g.Over=[],this.g.Beneath=[];for(var l=0;l<this.g.Graph.length;l++)this.g.Over[l]=null,this.g.Beneath[l]=null;for(var l=0;l<this.g.Graph.length;l++)for(var e=this.g.Coord[l],G=l+1;G<this.g.Graph.length;G++){var y=this.g.Coord[G];if(y[2]==e[2]+2&&y[0]==e[0]-1&&y[1]==e[1]-1){this.g.Over[l]=G,this.g.Beneath[G]=l;break}}this.g.EachDirection=function(o,e){for(var t=0;t<12;t++){var i=r.g.Graph[o][t];if(null!=i&&0==e(i,t))return}},this.g.EachDirectionDown=function(o,e){for(var t=[0,1,2,3],i=0;i<t.length;i++){var a=r.g.Graph[o][t[i]];if(null!=a&&0==e(a,t[i]))return}},this.g.EachDirectionUp=function(o,e){for(var t=[8,9,10,11],i=0;i<t.length;i++){var a=r.g.Graph[o][t[i]];if(null!=a&&0==e(a,t[i]))return}},this.g.EachDirectionFlat=function(o,e){for(var t=[4,5,6,7],i=0;i<t.length;i++){var a=r.g.Graph[o][t[i]];if(null!=a&&0==e(a,t[i]))return}},this.g.EachDirectionFlatDown=function(o,e){for(var t=[0,1,2,3,4,5,6,7],i=0;i<t.length;i++){var a=r.g.Graph[o][t[i]];if(null!=a&&0==e(a,t[i]))return}},this.g.EachDirectionFlatUp=function(o,e){for(var t=[4,5,6,7,8,9,10,11],i=0;i<t.length;i++){var a=r.g.Graph[o][t[i]];if(null!=a&&0==e(a,t[i]))return}},this.zobrist=new JocGame.Zobrist({board:{type:"array",size:this.g.Graph.length,values:[0,1]}}),this.InitGameExtra()},Model.Game.MapSameLevelDiagGraph=function(){for(var r=[0,16,25,29],o=0;o<4;o++)for(var e=0;e<4-o;e++)for(var t=0;t<4-o;t++)for(var i=r[o]+e*(4-o)+t,a=-1;a<2;a+=2)for(var n=-1;n<2;n+=2){var s=o,p=e+a,u=t+n;s>=0&&s<4&&p>=0&&p<4-s&&u>=0&&u<4-s?this.g.Graph[i].push(r[s]+p*(4-s)+u):this.g.Graph[i].push(null)}},Model.Game.InitGameExtra=function(){},Model.Game.DestroyGame=function(){this.DestroyGameExtra()},Model.Game.DestroyGameExtra=function(){},Model.Game.spUpdateZobrist=function(r,o,e,t,i,a){for(var n=0;n<o.length;n++)r=this.zobrist.update(r,"board",e,o[n]);for(var n=0;n<t.length;n++)r=this.zobrist.update(r,"board",i,t[n]);return r},Model.Move.Init=function(r){for(var o in r)r.hasOwnProperty(o)&&(this[o]=JSON.parse(JSON.stringify(r[o])))},Model.Move.ToString=function(){var r=["?","W","B","R"][this.clr],o="";switch(this.act){case"+":o+="+"+this.pos+r;break;case">":o+=this.from+">"+this.to+r}return o},Model.Board.Init=function(r){},Model.Board.InitialPosition=function(r){this.spInitialPosition(r)},Model.Board.spInitialPosition=function(r){this.board=[];for(var o=0;o<r.g.Graph.length;o++)this.board[o]=0;this.maxLayer=0,this.ballCount=[0,0,0],this.playables={},this.height=[0,0,0],this.zSign=0;for(var o=0;o<r.mOptions.size*r.mOptions.size;o++)this.playables[o]=!0},Model.Board.MakeFreeMoves=function(r){var o=[];for(var e in this.playables)o.push({act:"+",pos:e,clr:this.mWho==JocGame.PLAYER_A?1:2});return o},Model.Board.GenerateMoves=function(r){var o=this.GenerateAllMoves(r),e=r.mOptions.moveCount;0==o.length?(this.mFinished=!0,this.ballCount[1]>this.ballCount[2]?this.mWinner=JocGame.PLAYER_A:this.ballCount[1]<this.ballCount[2]?this.mWinner=JocGame.PLAYER_B:this.mWinner=JocGame.DRAW):void 0!==e&&o.length>e&&(r.ArrayShuffle(o),o.sort(function(r,o){o.nextBoard.evaluation,r.nextBoard.evaluation}),o.splice(e,o.length-e)),this.mMoves=o},Model.Board.GenerateAllMoves=function(r){return this.MakeFreeMoves(r)},Model.Board.Evaluate=function(r,o,e){this.mEvaluation=0},Model.Board.ApplyMove=function(r,o){this.spApplyMove(r,o)},Model.Board.spApplyMove=function(r,o){function e(o){delete t.playables[o],r.g.EachDirectionFlat(o,function(e,i){if(t.board[e]){var a,n;switch(i){case 4:a=7,n=10;break;case 5:a=6,n=9;break;case 6:a=4,n=8;break;case 7:a=5,n=11}var s=r.g.Graph[o][a];null!==s&&t.board[s]>0&&t.board[r.g.Graph[e][a]]&&(t.playables[r.g.Graph[o][n]]=!0)}})}var t=this;switch(o.act){case"+":this.board[o.pos]=o.clr;var i=r.g.Coord[o.pos][2];i>this.maxLayer&&(this.maxLayer=i),this.height[o.clr]+=i,this.ballCount[o.clr]++,e(o.pos);break;case">":o.down.length>0?this.playables[o.down[o.down.length-1]]=!0:this.playables[o.from]=!0;var a=o.from;for(var n in o.down){var s=o.down[n];this.height[this.board[s]]--,this.board[a]=this.board[s],a=s}this.board[a]=0,this.board[o.to]=o.clr;var i=r.g.Coord[o.to][2];this.height[o.clr]+=i,i>this.maxLayer&&(this.maxLayer=i),e(o.to)}},Model.Board.IsValidMove=function(r,o){return!0},Model.Board.ExtendMove=function(r,o){return{}},Model.Board.GetSignature=function(){return this.zSign},Model.Board.InitialPosition=function(r){this.spInitialPosition(r),this.groupMaxId=1,this.groups={},this.posGroup={},this.posFree={},this.center=0,this.moveEvaluation=0},Model.Board.GenerateAllMoves=function(r){for(var o=this.MakeFreeMoves(r),e=[],t=0;t<o.length;t++){var i=o[t],a=this.ExtendMove(r,i.pos);if(null!==a){i.nextBoard=a.board,i.remove=a.remove;var n=!1;r.mVisitedBoards&&r.mVisitedBoards[i.nextBoard.zSign]&&(n=!0),0==n&&e.push(i)}}return e},Model.Board.ExtendMove=function(r,o,e,t){function i(e){var t=p.board[e],i={side:t,p:{},pCount:1,f:{},fCount:0};i.p[e]=!0;for(var a=[e];a.length>0;){var n=a.pop();r.g.EachDirection(n,function(e,s){var u=p.board[e];if(u==t){if(e in i.p)return!0;var h=r.g.Over[e];if(null!==h&&(0!=p.board[h]||o==h))return!0;var f=G[s];if(void 0!==f){var v=r.g.Graph[n][f[0]],d=r.g.Graph[n][f[1]];if((v==o&&t==l||p.board[v]==3-t)&&(d==o&&t==l||p.board[d]==3-t))return!0}i.p[e]=!0,i.pCount++,a.push(e)}else if(0==u&&e!=o&&0==r.g.Coord[e][2]){if(e in i.f)return!0;i.f[e]=!0,i.fCount++}return!0})}return i}function a(r){var o=p.groupMaxId++;p.groups[o]=r;for(var e in r.p){p.posGroup[e];p.posGroup[e]=o}for(var t in r.f)void 0===p.posFree[t]&&(p.posFree[t]={}),p.posFree[t][o]=!0;return o}function n(r,o){var e=[];for(var t in o)e.push(t);for(var i=e[0],a=p.groups[i],n=1;n<e.length;n++){var t=e[n],s=p.groups[t];for(var u in s.p)a.p[u]=!0,p.posGroup[u]=i;a.pCount+=s.pCount;for(var l in s.f)l in a.f||(a.f[l]=!0,a.fCount++),delete p.posFree[l][t],p.posFree[l][i]=!0;delete p.groups[t]}if(r>=0){for(var l in b)l in a.f||(a.f[l]=!0,a.fCount++),void 0===p.posFree[l]&&(p.posFree[l]={}),p.posFree[l][i]=!0;a.p[r]=!0,a.pCount++,p.posGroup[r]=i}}function s(r,o,e){var t=p.groups[o];for(var i in e)i in t.f||(t.f[i]=!0,t.fCount++,void 0===p.posFree[i]&&(p.posFree[i]={}),p.posFree[i][o]=!0);t.p[r]=!0,t.pCount++,p.posGroup[r]=o}arguments.length<3&&(e=0),arguments.length<4&&(t=null),null==t&&(t=this);var p=JSON.parse(JSON.stringify({board:t.board,playables:t.playables,ballCount:t.ballCount,groups:t.groups,posFree:t.posFree,posGroup:t.posGroup,groupMaxId:t.groupMaxId,center:t.center,zSign:t.zSign,mWho:t.mWho})),u={};0==e&&(e=this.mWho==JocGame.PLAYER_A?1:2);var l=3-e,h=r.g.Coord[o],f=h[2],v={},d=0,g={},c=0,b={},m=0,G={4:[8,10],5:[9,11],6:[8,9],7:[10,11]},y={4:[0,2],5:[1,3],6:[0,1],7:[2,3]},M={},C={},F=r.g.Beneath[o];if(null!=F){var E=p.posGroup[F],B=p.groups[E];delete B.p[F],B.pCount--,p.posGroup[F]=0;var S=p.board[F],x=r.g.Coord[F][2];r.g.EachDirection(F,function(o,e){var t=p.board[o];if(r.g.Coord[o][2]==x){var i=G[e],a=r.g.Graph[F][i[0]],n=r.g.Graph[F][i[1]];if(null!=a&&p.board[a]==3-S&&null!=n||p.board[n]==3-S)return!0}return t==S&&p.posGroup[o]>0&&(C[o]=!0),!0})}f>0&&r.g.EachDirectionFlat(o,function(t,i){if(p.board[t]==e){var a=y[i],n=r.g.Graph[o][a[0]],s=r.g.Graph[o][a[1]];p.board[n]==l&&p.board[s]==l&&(p.posGroup[n]&&(C[n]=!0),p.posGroup[s]&&(C[s]=!0))}return!0});var D={};for(var z in C){var O=p.posGroup[z];D[O]=!0}for(var O in D)!function(r){var o=p.groups[r];for(var e in o.p)0!=p.posGroup[e]&&(p.posGroup[e]=-1);for(var t in o.f)delete p.posFree[t][r];delete p.groups[r]}(O);for(var z in C)p.posGroup[z]<0&&a(i(z));r.g.EachDirection(o,function(r){if(0==p.board[r])return!0;var o=p.posGroup[r];return 0==o||(p.board[r]==e?void 0===v[o]&&(v[o]=!0,d++):p.board[r]==l&&void 0===g[o]&&(g[o]=!0,c++),!0)}),0==f&&r.g.EachDirectionFlat(o,function(r){return 0==p.board[r]&&(b[r]=!0,m++),!0});var A=p.posFree[o];if(void 0!==A){for(var O in A){var B=p.groups[O];delete B.f[o],B.fCount--}delete p.posFree[o]}if(0==d){var B={side:e,p:{},pCount:1,f:b,fCount:m};B.p[o]=!0,a(B)}else if(1==d){for(var E in v);s(o,E,b)}else n(o,v);var w=!1;for(var E in p.groups)if(0!=E){var B=p.groups[E];B.side==l&&0==B.fCount&&(!function(e){var t=p.groups[e],n={},s={},l=[];for(var h in t.p)l.push({p:h,z:r.g.Coord[h][2]});l.sort(function(r,o){return o.z-r.z});for(var f=0;f<l.length;f++){var v=l[f],h=v.p,d=!1;if(r.g.EachDirectionUp(h,function(r){return!p.board[r]&&r!=o||(d=!0,!1)}),d)n[h]=!0,p.posGroup[h]=-1;else{0==v.z&&(s[h]=!0),p.board[h]=0,u[h]=!0,delete p.posGroup[h],p.ballCount[t.side]--,p.playables[h]=!0,r.g.EachDirectionUp(h,function(r){return p.playables[r]&&delete p.playables[r],!0});var g=r.g.Beneath[h];if(g)if(p.board[g]==t.side){var c=!1;if(r.g.EachDirectionDown(h,function(r){return p.board[r]!=t.side||(c=!0,!1)}),c){t.p[g]=!0,t.pCount++,p.posGroup[g]=e;for(var b={p:g,z:r.g.Coord[g][2]},m=f+1;m<l.length&&b.z<l[m].z;m++);l.splice(m,0,b)}else M[g]=!0}else M[g]=!0}}for(var G in t.f)delete p.posFree[G][e];delete p.groups[e];for(var G in s)r.g.EachDirectionFlat(G,function(r){var o=p.posGroup[r];if(void 0!==o&&o>0&&(void 0===p.posFree[G]&&(p.posFree[G]={}),void 0===p.posFree[G][o])){p.posFree[G][o]=!0;var e=p.groups[o];e.f[G]=!0,e.fCount++}return!0});for(var h in n)p.posGroup[h]==-1&&a(i(h))}(E),w=!0)}for(var z in M)if(0==p.posGroup[z]){var I=p.board[z],J={},P=0,W={},k=0,L=r.g.Coord[z][2];if(r.g.EachDirection(z,function(o,e){if(0==p.board[o])return!0;var t=p.posGroup[o];if(0==t)return!0;if(r.g.Coord[o][2]==L){var i=G[e],a=r.g.Graph[z][i[0]],n=r.g.Graph[z][i[1]];if(null!=a&&p.board[a]==3-I&&null!=n&&p.board[n]==3-I)return!0}return p.board[o]==I?void 0===J[t]&&(J[t]=!0,P++):0==p.board[o]&&0==r.g.Coord[o][2]&&(W[o]=!0,k++),!0}),0==P){var B={side:I,p:{},pCount:1,f:W,fCount:k};B.p[z]=!0;var E=a(B)}else if(1==P){for(var E in J);s(z,E,{})}else n(z,J)}if(w){var N=[];for(var E in p.groups)if(0!=E){var B=p.groups[E];B.side==e&&N.push(E)}N.sort(function(r,o){return parseInt(r)-parseInt(o)});for(var R=[],U=0;U<N.length;U++){var E=N[U],B=p.groups[E];for(var z in B.p){r.g.EachDirectionFlat(z,function(o,t){if(p.board[o]!=e)return!0;var i=p.posGroup[o];if(i!=E&&0!=i){var a=G[t],n=r.g.Graph[z][a[0]],s=r.g.Graph[z][a[1]];if(null==n||p.board[n]!=l||null==s||p.board[s]!=l){for(var u=null,h=[],f=0;f<R.length;f++){var v=R[f];if(E in v||i in v)if(u){for(var d in v)u[d]=!0;h.push(f)}else v[E]=!0,v[i]=!0,u=v}for(var f=h.length-1;f>=0;f--)R.splice(h[f],1);if(null==u){var v={};v[E]=!0,v[i]=!0,R.push(v)}}}return!0})}}for(var U=0;U<R.length;U++)n(-1,R[U])}for(var E in p.groups)if(0!=E){var B=p.groups[E];if(B.side==e&&0==B.fCount)for(var z in B.p){var H=!1;if(r.g.EachDirectionUp(z,function(r){return!(p.board[r]>0)||(H=!0,!1)}),0==H)return null}}var _=[];for(var E in p.groups){var B=p.groups[E];B.eyes=0;for(var z in B.p)_.push({p:z,z:r.g.Coord[z][2],group:B,gid:E})}_.sort(function(r,o){return o.z-r.z});for(var j={},Y={},U=0;U<_.length;U++){var V=_[U],Z=!1;r.g.EachDirectionUp(V.p,function(r){var o=j[r];return!(void 0!==o&&V.group.side&3-o)||(Z=!0,!1)}),V.pinned=Z,Y[V.p]=V,j[V.p]=Z?3:V.group.side}for(var T in p.posFree){var X=0,$=!0;r.g.EachDirectionFlat(T,function(r){if(0==p.board[r])return $=!1,!1;var o=p.posGroup[r];return 0!=X&&o!=X?($=!1,!1):(X=o,!0)}),0==X&&($=!1),$&&p.groups[X].eye++}p.relativeSecured=0,p.relativeHeight=0;var q=r.mOptions.levelOptions;for(var E in p.groups){var B=p.groups[E],K=1==B.side?1:-1,Q=q.evalSafety;B.eyes>=2?Q=q.evalSafety2eyes+Math.log(B.eyes-1)*q.evalSafetyXEyesBonus:1==B.fCount?Q=q.evalSafety1f:3==B.fCount?Q=q.evalSafety3f:B.fCount>3&&(Q=q.evalSafety3fMore+Math.log(B.fCount-3)*q.evalSafety3fMoreBonus),1==B.eyes&&(Q+=q.evalSafety1eyeBonus);for(var z in B.p){var V=Y[z],rr=Q;V.pinned&&(rr+=q.evalSafetyPinnedBonus),p.relativeSecured+=rr*K,p.relativeHeight+=V.z*K}}if(0==f){var K=1==e?1:-1,or=Math.abs(h[0]-(r.mOptions.size-1)/2)+Math.abs(h[1]-(r.mOptions.size-1)/2);p.center+=or*K*-1}p.moveEvaluation=p.relativeSecured+q.evalHeightRatio*p.relativeHeight+q.evalCenterRatio*p.center;var er=[];for(var tr in u)er.push(tr);return p.zSign=r.spUpdateZobrist(p.zSign,[o],e-1,er,2-e),{board:p,remove:er}},Model.Board.Evaluate=function(r,o,e){this.mEvaluation=this.moveEvaluation},Model.Board.CheckConsistency=function(r){for(var o=[0,0,0],e=0;e<r.g.Graph.length;e++){var t=(r.g.Coord[e],this.board[e]);if(t>0){if(void 0===this.posGroup[e])return console.error("pos",e,"side",t,"not assigned to any group"),!1;if(this.posFree[e]){var i=null;for(i in this.posFree[e]);if(null!=i)return console.error("pos",e,"side",t,"set as free for group",i),!1}o[t]++}else if(this.posGroup[e])return console.error("empty pos",e,"in posGroup"),!1;var a=r.g.Over[e];if(null!=a&&this.board[a]>0&&0!=this.posGroup[e])return console.error("buried ball",e,"does not have posGroup 0 but",this.posGroup[e]),!0}if(o[1]!=this.ballCount[1]||o[2]!=this.ballCount[2])return console.error("ball count mismatch, got",o[1],o[2],"expecting",this.ballCount[1],this.ballCount[2]),!1;for(var e in this.posGroup){if(0==this.board[e])return console.error("posGroup pos",e,"is empty"),!1;if(0!=this.posGroup[e]){if(void 0===this.groups[this.posGroup[e]])return console.error("posGroup",e,"in unknown group",this.posGroup[e]),!1;if(!(e in this.groups[this.posGroup[e]].p))return console.error("posGroup",e,"does not match group"),!1}}for(var e in this.posFree){if(0!=this.board[e])return console.error("posFree pos",e,"is not empty"),!1;for(var n in this.posFree[e]){var s=this.groups[n];if(void 0===s)return console.error("posFree pos",e,"group",n,"does not exist"),!1;if(!(e in s.f))return console.error("posFree pos",e,"group",n,"not in group freedoms"),!1}}for(var n in this.groups){var s=this.groups[n],p=0;for(var u in s.p){if(0==this.board[u])return console.error("pos",u,"in group",n,"marked as empty"),!1;if(this.board[u]!=s.side)return console.error("pos",u,"in group",n,"has wrong side"),!1;if(this.posGroup[u]!=n)return console.error("pos",u,"in group",n,"has wrong group",this.posGroup[u]),!1;p++}if(p!=s.pCount)return console.error("group",n,"count mismatch"),!1;p=0;for(var u in s.f){if(0!=this.board[u])return console.error("freedom pos",u,"in group",n,"is not empty"),!1;if(0!=r.g.Coord[u][2])return console.error("freedom pos",u,"in group",n,"not at ground level"),!1;if(void 0===this.posFree[u])return console.error("freedom pos",u,"in group",n,"not in freedoms"),!1;if(!this.posFree[u][n])return console.error("freedom pos",u,"in group",n,"is not empty for group"),!1;p++}if(p!=s.fCount)return console.error("group",n,"freedom count mismatch"),!1}return!0},Model.Board.ApplyMove=function(r,o){if(void 0===o.nextBoard){var e=this.ExtendMove(r,o.pos);e||console.log("move",o,JSON.stringify(r.mPlayedMoves)),this.CopyFrom(e.board)}else this.CopyFrom(o.nextBoard);this.spApplyMove(r,o)},Model.Board.CopyFrom=function(r){this.groupMaxId=r.groupMaxId,this.center=r.center,this.maxLayer=r.maxLayer,this.zSign=r.zSign,this.mWho=r.mWho,this.moveEvaluation=r.moveEvaluation,this.board=[],this.ballCount=[0,r.ballCount[1],r.ballCount[2]];for(var o=0;o<r.board.length;o++)this.board.push(r.board[o]);this.playables={};for(var o in r.playables)this.playables[o]=!0;this.groups={};for(var e in r.groups){var t=r.groups[e],i={side:t.side,p:{},pCount:t.pCount,f:{},fCount:t.fCount};for(var o in t.p)i.p[o]=!0;for(var o in t.f)i.f[o]=!0;this.groups[e]=i}this.posFree={};for(var o in r.posFree){var a={};for(var n in r.posFree[o])a[n]=!0;this.posFree[o]=a}this.posGroup={};for(var o in r.posGroup)this.posGroup[o]=r.posGroup[o];r.height?this.height=[0,r.height[1],r.height[2]]:this.height=[0,0,0],void 0!==r.mEvaluation&&(this.mEvaluation=r.mEvaluation),void 0!==r.mFinished&&(this.mFinished=r.mFinished),void 0!==r.mWinner&&(this.mWinner=r.mWinner)},Model.Game.Save=function(){for(var r={playedMoves:[],game:JoclyHub.modelName},o=0;o<this.mPlayedMoves.length;o++){var e=new(this.GetMoveClass())(this.mPlayedMoves[o]);delete e.nextBoard,delete e.remove,delete e.boardJSON,r.playedMoves.push(e)}var t=new Date;if(r.date=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+"-"+t.getHours()+"_"+t.getMinutes()+"_"+t.getSeconds(),JoclyHub.network.connected){$(".jocly-temp").remove();var i=document.createElement("form");i.setAttribute("class","jocly-temp"),i.setAttribute("style","display: none;"),i.setAttribute("method","post"),i.setAttribute("action","/jocly/save-game");var a=document.createElement("input");a.setAttribute("type","hidden"),a.setAttribute("name","data"),a.setAttribute("value",JSON.stringify(r)),i.appendChild(a),document.body.appendChild(i),i.submit()}else{var n=r.game+"-"+r.date+".joc",s="data:application/x-joc;filename="+n+","+encodeURIComponent(JSON.stringify(r));window.open(s,n)}},Model.Move.Strip=function(){if(void 0!==this.nextBoard||void 0!==this.remove){var r={};for(var o in this)this.hasOwnProperty(o)&&"nextBoard"!=o&&(r[o]=JSON.parse(JSON.stringify(this[o])));return r}return this};